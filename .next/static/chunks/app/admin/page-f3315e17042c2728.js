(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{7567:function(e,s,t){Promise.resolve().then(t.bind(t,9725))},9725:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(7437),a=t(2265),i=t(2141);let n=[{id:"E-1-ALL",name:"E-1",description:"Flat Rate (Tiered Pricing)",season:"All Year"},{id:"E-TOU-C-W",name:"E-TOU-C",description:"Time-of-Use (4-9pm Peak)",season:"Winter"},{id:"E-TOU-C-S",name:"E-TOU-C",description:"Time-of-Use (4-9pm Peak)",season:"Summer"},{id:"E-TOU-D-W",name:"E-TOU-D",description:"Time-of-Use (3-8pm Peak)",season:"Winter"},{id:"E-TOU-D-S",name:"E-TOU-D",description:"Time-of-Use (3-8pm Peak)",season:"Summer"},{id:"EV2-A-W",name:"EV2-A",description:"Time-of-Use (EV Owners)",season:"Winter"},{id:"EV2-A-S",name:"EV2-A",description:"Time-of-Use (EV Owners)",season:"Summer"}];function o(){var e,s,t,o,d;let[l,c]=(0,a.useState)(null),[m,x]=(0,a.useState)(null),h=async e=>{try{let s,t;x(null),console.log("Starting PDF processing for path:",e),console.log("Sending PDF path for processing:",e);try{s=await fetch("/api/parse-pdf",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({pdfPath:e})})}catch(e){throw console.error("Network error:",e),Error("Failed to connect to server")}let r=await s.text();console.log("Raw server response:",r);try{t=JSON.parse(r),console.log("Parsed server response:",t)}catch(e){throw console.error("Error parsing server response:",{status:s.status,statusText:s.statusText,rawResponse:r,parseError:e}),Error("Server returned invalid JSON response")}if(!s.ok){let e=t.details||t.error||"Failed to parse PDF";throw console.error("Server error:",{status:s.status,statusText:s.statusText,data:t}),Error(e)}x(t),console.log("PDF parsed successfully")}catch(e){console.error("PDF processing error:",{message:e instanceof Error?e.message:"Unknown error",error:e,stack:e instanceof Error?e.stack:void 0}),x({error:!0,message:e instanceof Error?e.message:"Failed to process PDF",timestamp:new Date().toISOString(),details:e instanceof Error?e.stack:void 0})}},[p,u]=(0,a.useState)(null),[g,f]=(0,a.useState)(!0),[v,j]=(0,a.useState)([]),[y,N]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let{data:{user:e},error:s}=await i.O.auth.getUser();if(s||!e){console.error("Auth error:",s),window.location.replace("/admin/login");return}console.log("User authenticated:",e.email),u(e),await b()}catch(e){console.error("Auth check failed:",e),window.location.replace("/admin/login")}finally{f(!1)}})()},[]);let b=async()=>{try{let{data:e,error:s}=await i.O.from("submissions").select("*").order("created_at",{ascending:!1});if(s)throw s;j(e||[])}catch(e){console.error("Error fetching submissions:",e),N(e.message)}},w=async e=>{try{let{data:s,error:t}=await i.O.storage.from("pdfs").download(e);if(t)throw t;let r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=e.split("/").pop()||"download.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}catch(e){console.error("Error downloading file:",e),N(e.message)}},k=async()=>{try{await i.O.auth.signOut(),window.location.replace("/admin/login")}catch(e){console.error("Error signing out:",e),N(e.message)}};return g?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,r.jsx)("div",{className:"text-xl font-semibold text-gray-800",children:"Loading..."})}):p?(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Logged in as: ",p.email]})]}),(0,r.jsx)("button",{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Sign Out"})]}),y&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-red-600",children:y})}),m&&(0,r.jsxs)("div",{className:"mb-8 p-4 bg-white border rounded-lg shadow-sm ".concat(m.error?"border-red-200":"border-gray-200"),children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:m.error?"PDF Parsing Error":"Parsed PDF Results"}),m.error?(0,r.jsxs)("div",{className:"bg-red-50 p-4 rounded",children:[(0,r.jsxs)("p",{className:"text-red-700 mb-2",children:["Error: ",m.message]}),(0,r.jsxs)("p",{className:"text-red-500 text-sm",children:["Time: ",new Date(m.timestamp).toLocaleString()]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Total Pages: ",m.totalPages]})}),(0,r.jsx)("div",{className:"space-y-6",children:m.error?(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-4",children:[(0,r.jsx)("h3",{className:"text-md font-medium text-red-800 mb-2",children:"Error Processing PDF"}),(0,r.jsx)("p",{className:"text-sm text-red-600",children:m.details||m.message})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-2",children:"PDF Information"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-1",children:[(null===(e=m.metadata)||void 0===e?void 0:e.title)&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Title:"})," ",m.metadata.title]}),(null===(s=m.metadata)||void 0===s?void 0:s.author)&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Author:"})," ",m.metadata.author]}),(null===(t=m.metadata)||void 0===t?void 0:t.pageCount)&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Pages:"})," ",m.metadata.pageCount]}),(null===(o=m.metadata)||void 0===o?void 0:o.version)&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-medium",children:"PDF Version:"})," ",m.metadata.version]})]})]}),null===(d=m.pages)||void 0===d?void 0:d.map((e,s)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Page ",e.pageNumber]})}),(0,r.jsx)("pre",{className:"p-4 text-sm whitespace-pre-wrap overflow-auto max-h-[400px] bg-white",children:e.content})]},s))]})})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Info"}),(0,r.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate Schedule"}),(0,r.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Energy Usage (kWh)"}),(0,r.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===v.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"px-4 py-4 text-center text-gray-500",children:"No submissions found"})}):v.map(e=>{var s,t,a,i,o;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"px-4 py-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsxs)("td",{className:"px-4 py-4",children:[(0,r.jsx)("div",{className:"text-sm text-gray-900",children:(null===(s=n.find(s=>s.id===e.rate_schedule))||void 0===s?void 0:s.name)||"-"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:(null===(t=n.find(s=>s.id===e.rate_schedule))||void 0===t?void 0:t.description)||"-"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:(null===(a=n.find(s=>s.id===e.rate_schedule))||void 0===a?void 0:a.season)||"-"})]}),(0,r.jsx)("td",{className:"px-4 py-4",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Peak:"})," ",(null===(i=e.peak_kwh)||void 0===i?void 0:i.toFixed(2))||"-"," kWh"]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Off-Peak:"})," ",(null===(o=e.offpeak_kwh)||void 0===o?void 0:o.toFixed(2))||"-"," kWh"]})]})}),(0,r.jsx)("td",{className:"px-4 py-4 text-sm",children:(0,r.jsxs)("div",{className:"space-y-2",children:[e.pdf_path&&(0,r.jsx)("button",{onClick:()=>h(e.pdf_path),className:"inline-flex items-center text-xs text-blue-600 hover:text-blue-800 mr-4",children:"Parse PDF"}),e.pdf_path&&(0,r.jsx)("button",{onClick:()=>w(e.pdf_path),className:"block w-full px-3 py-1 text-center text-indigo-600 hover:text-indigo-900 border border-indigo-600 rounded hover:bg-indigo-50",children:"Download PDF"}),(0,r.jsx)("button",{onClick:()=>console.log("View details:",e.id),className:"block w-full px-3 py-1 text-center text-gray-600 hover:text-gray-900 border border-gray-300 rounded hover:bg-gray-50",children:"Edit Details"})]})})]},e.id)})})]})})})]})})}):(window.location.replace("/admin/login"),null)}},2141:function(e,s,t){"use strict";t.d(s,{O:function(){return r}});let r=(0,t(3777).eI)("https://umuqydzeqqifiywqsxec.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtdXF5ZHplcXFpZml5d3FzeGVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg5ODM5NzMsImV4cCI6MjA1NDU1OTk3M30.2cudPRraCD6W4oolwfnH5ZYm1CN9FOSkrs-brtsEEbk",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}},function(e){e.O(0,[777,971,117,744],function(){return e(e.s=7567)}),_N_E=e.O()}]);